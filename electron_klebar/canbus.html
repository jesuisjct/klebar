<script type="text/javascript">
var http = require('http'); 


var $dropDownItems = $('#command_dropdown').children();

    $dropDownItems.on('click', function() {
      $("#command_canbus").val($(this).html())
  })


function copy_cmd()
{
  var x = $("#command_dropdown").SelectedIndex
  $("#command_canbus").val(x)
  window.alert(x)

}
function send_canbus()
{
    if($("#command_canbus").val() == "") 
    {   $("#status_canbus").html("error : command is empty")
        return;
    }
    const options = {
        hostname: 'localhost',
        port: 8080,
        path: '/do?action=ceci&param=cela',
        method: 'GET'
    }
    let cocan = $("#command_canbus").val()
    let comcan = cocan.split("=")[1].trim()
    options.path = "/can" + "?node=" + $("#node_canbus").val() + "&command=" + comcan + "&param=" + $("#param_canbus").val()
    console.log(options.path)
    const req = http.request(options, res => {
        console.log(`statusCode: ${res.statusCode}`)
        $("#status_canbus").html(`Status code  : ${res.statusCode} ${res.statusMessage} `)
        res.on('data', message => {
          console.log("data :" + message)
          $("#response_canbus").html(" " + message)
        })
    })
    
    req.on('error', error => {
        console.error(error)
        $("#status_canbus").html(error)
    })
    
    req.end()
}

</script>

<div>
    <br>
    Klebar CAN bus control
    <br> <br>
    <div class="input-group mb-3">
      <div class="input-group-prepend">
        <span style="width: 120px; " class="input-group-text" id="inputGroup-sizing-default">node</span>
      </div>
      <input id="node_canbus"  type="text" class="form-control" aria-label="Command" aria-describedby="inputGroup-sizing-default">
    </div>
    <div class="input-group mb-3">
      <div class="input-group-prepend">
        <button id="cmd" class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Dropdown</button>
        <div id="command_dropdown" class="dropdown-menu">
          <button class="dropdown-item" href="#">Action</button>

          <a class="dropdown-item" href="#">CO_NMT_CTRL = 0x000  </a>
          <a class="dropdown-item" href="#">ODRIVE_HEARTBEAT  =1  </a>
          <a class="dropdown-item" href="#">ODRIVE_ESTOP  =2  </a>
          <a class="dropdown-item" href="#">GET_MOTOR_ERROR =3 </a>
          <a class="dropdown-item" href="#">GET_ENCODER_ERROR =4 </a>
          <a class="dropdown-item" href="#">GET_SENSORLESS_ERROR  =5  </a>
          <a class="dropdown-item" href="#">SET_AXIS_NODE_ID  =6  </a>
          <a class="dropdown-item" href="#">SET_AXIS_REQUESTED_STATE  =7  </a>
          <a class="dropdown-item" href="#">SET_AXIS_STARTUP_CONFIG =8 </a>
          <a class="dropdown-item" href="#">GET_ENCODER_ESTIMATES =9 </a>
          <a class="dropdown-item" href="#">GET_ENCODER_COUNT =10 </a>
          <a class="dropdown-item" href="#">SET_CONTROLLER_MODES  =11 </a>
          <a class="dropdown-item" href="#">SET_INPUT_POS =12 </a>
          <a class="dropdown-item" href="#">SET_INPUT_VEL =13 </a>
          <a class="dropdown-item" href="#">SET_INPUT_CURRENT =14 </a>
          <a class="dropdown-item" href="#">SET_VEL_LIMIT =15 </a>
          <a class="dropdown-item" href="#">START_ANTICOGGING =16   </a>
          <a class="dropdown-item" href="#">SET_TRAJ_VEL_LIMIT  =17  </a>
          <a class="dropdown-item" href="#">SET_TRAJ_ACCEL_LIMITS =18 </a>
          <a class="dropdown-item" href="#">SET_TRAJ_A_PER_CSS  =19  </a>
          <a class="dropdown-item" href="#">GET_IQ  =20  </a>
          <a class="dropdown-item" href="#">GET_SENSORLESS_ESTIMATES  =21  </a>
          <a class="dropdown-item" href="#">RESET_ODRIVE  =22  </a>
          <a class="dropdown-item" href="#">GET_VBUS_VOLTAGE  =23  </a>
          <a class="dropdown-item" href="#">CLEAR_ERRORS  =24  </a>
          <a class="dropdown-item" href="#">CO_HEARTBEAT_CMD = 0x700 </a>


          <a class="dropdown-item" href="#">Another action</a>
          <a class="dropdown-item" href="#">Something else here</a>
          <div role="separator" class="dropdown-divider"></div>

        </div>
      </div>
      <input id="command_canbus" type="text" class="form-control" aria-label="Parameter" aria-describedby="inputGroup-sizing-default">
    </div>    
    <div class="input-group mb-3">
      <div class="input-group-prepend">
        <span style="width: 120px; " class="input-group-text" id="inputGroup-sizing-default">parameter</span>
      </div>
      <input id="param_canbus" type="text" class="form-control" aria-label="Parameter" aria-describedby="inputGroup-sizing-default">
    </div>

    <br><br>
    <div class="input-group mb-3">
      <div class="input-group-prepend">
        <span style="width: 120px; " class="input-group-text">Status</span>
      </div>
      <textarea id="status_canbus" readonly class="form-control" aria-label="Status"></textarea>
    </div>
    <div class="input-group mb-3">
      <div class="input-group-prepend">
        <span style="width: 120px; " class="input-group-text">Response</span>
      </div>
      <textarea id="response_canbus" readonly class="form-control" aria-label="Response"></textarea>
    </div>

    <br><br>
    <button type="button" class="btn btn-light" onclick="send_canbus()"> Send CAN bus </button>
    <br>
  </div>