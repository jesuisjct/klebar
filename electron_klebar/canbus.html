<script type="text/javascript">
var http = require('http'); 


var $dropDownItems = $('#command_dropdown').children();

    $dropDownItems.on('click', function() {
    $("#command_canbus").val($dropDownItems.index(this))
  //console.log('index: ', $dropDownItems.index(this), 'text: ', this.textContent)
  })


function copy_cmd()
{
  var x = $("#command_dropdown").SelectedIndex
  $("#command_canbus").val(x)
  window.alert(x)

}
function send_canbus()
{
    if($("#command_canbus").val() == "") 
    {   $("#status_canbus").html("error : command is empty")
        return;
    }
    const options = {
        hostname: 'localhost',
        port: 8080,
        path: '/do?action=ceci&param=cela',
        method: 'GET'
    }
    options.path = "/can" + "?node=" + $("#node_canbus").val() + "&command=" + $("#command_canbus").val()+ "&param=" + $("#param_canbus").val()
    console.log(options.path)
    const req = http.request(options, res => {
        console.log(`statusCode: ${res.statusCode}`)
        $("#status_canbus").html(`Status code  : ${res.statusCode} ${res.statusMessage} `)
        res.on('data', message => {
          console.log("data :" + message)
          $("#response_canbus").html(" " + message)
        })
    })
    
    req.on('error', error => {
        console.error(error)
        $("#status_canbus").html(error)
    })
    
    req.end()
}

</script>

<div>
    <br>
    Klebar CAN bus control
    <br> <br>
    <div class="input-group mb-3">
      <div class="input-group-prepend">
        <span style="width: 120px; " class="input-group-text" id="inputGroup-sizing-default">node</span>
      </div>
      <input id="node_canbus"  type="text" class="form-control" aria-label="Command" aria-describedby="inputGroup-sizing-default">
    </div>
    <div class="input-group mb-3">
      <div class="input-group-prepend">
        <button id="cmd" class="btn btn-outline-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Dropdown</button>
        <div id="command_dropdown" class="dropdown-menu">
          <button class="dropdown-item" href="#">Action</button>

          <a class="dropdown-item" href="#">MSG_CO_NMT_CTRL = 0x000  </a>
          <a class="dropdown-item" href="#">MSG_ODRIVE_HEARTBEAT  </a>
          <a class="dropdown-item" href="#">MSG_ODRIVE_ESTOP  </a>
          <a class="dropdown-item" href="#">MSG_GET_MOTOR_ERROR </a>
          <a class="dropdown-item" href="#">MSG_GET_ENCODER_ERROR </a>
          <a class="dropdown-item" href="#">MSG_GET_SENSORLESS_ERROR  </a>
          <a class="dropdown-item" href="#">MSG_SET_AXIS_NODE_ID  </a>
          <a class="dropdown-item" href="#">MSG_SET_AXIS_REQUESTED_STATE  </a>
          <a class="dropdown-item" href="#">MSG_SET_AXIS_STARTUP_CONFIG </a>
          <a class="dropdown-item" href="#">MSG_GET_ENCODER_ESTIMATES </a>
          <a class="dropdown-item" href="#">MSG_GET_ENCODER_COUNT </a>
          <a class="dropdown-item" href="#">MSG_SET_CONTROLLER_MODES </a>
          <a class="dropdown-item" href="#">MSG_SET_INPUT_POS </a>
          <a class="dropdown-item" href="#">MSG_SET_INPUT_VEL </a>
          <a class="dropdown-item" href="#">MSG_SET_INPUT_CURRENT </a>
          <a class="dropdown-item" href="#">MSG_SET_VEL_LIMIT </a>
          <a class="dropdown-item" href="#">MSG_START_ANTICOGGING   </a>
          <a class="dropdown-item" href="#">MSG_SET_TRAJ_VEL_LIMIT  </a>
          <a class="dropdown-item" href="#">MSG_SET_TRAJ_ACCEL_LIMITS </a>
          <a class="dropdown-item" href="#">MSG_SET_TRAJ_A_PER_CSS  </a>
          <a class="dropdown-item" href="#">MSG_GET_IQ  </a>
          <a class="dropdown-item" href="#">MSG_GET_SENSORLESS_ESTIMATES  </a>
          <a class="dropdown-item" href="#">MSG_RESET_ODRIVE  </a>
          <a class="dropdown-item" href="#">MSG_GET_VBUS_VOLTAGE  </a>
          <a class="dropdown-item" href="#">MSG_CLEAR_ERRORS  </a>
          <a class="dropdown-item" href="#">MSG_CO_HEARTBEAT_CMD = 0x700 </a>


          <a class="dropdown-item" href="#">Another action</a>
          <a class="dropdown-item" href="#">Something else here</a>
          <div role="separator" class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">Separated link</a>
        </div>
      </div>
      <input id="command_canbus" type="text" class="form-control" aria-label="Parameter" aria-describedby="inputGroup-sizing-default">
    </div>    
    <div class="input-group mb-3">
      <div class="input-group-prepend">
        <span style="width: 120px; " class="input-group-text" id="inputGroup-sizing-default">parameter</span>
      </div>
      <input id="param_canbus" type="text" class="form-control" aria-label="Parameter" aria-describedby="inputGroup-sizing-default">
    </div>

    <br><br>
    <div class="input-group mb-3">
      <div class="input-group-prepend">
        <span style="width: 120px; " class="input-group-text">Status</span>
      </div>
      <textarea id="status_canbus" readonly class="form-control" aria-label="Status"></textarea>
    </div>
    <div class="input-group mb-3">
      <div class="input-group-prepend">
        <span style="width: 120px; " class="input-group-text">Response</span>
      </div>
      <textarea id="response_canbus" readonly class="form-control" aria-label="Response"></textarea>
    </div>

    <br><br>
    <button type="button" class="btn btn-light" onclick="send_canbus()"> Send CAN bus </button>
    <br>
  </div>